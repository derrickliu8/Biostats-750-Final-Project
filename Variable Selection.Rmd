---
title: "Variable Selection"
author: "Derrick Liu"
date: "4/24/2021"
output: html_document
---

```{r}
heart_dat <- read.csv("heart.csv")
head(heart_dat)
```

# Best subset selection

```{r}
library(leaps)

best_subset_fit <- regsubsets(output ~ ., data = heart_dat, nvmax = 13)
summary(best_subset_fit)
```

```{r}
# Finding the number of predictors in the models selected by best subset selection
# that has the largest R^2

plot(summary(best_subset_fit)$adjr2, xlab = "Number of Variables", 
     ylab = "Adjusted RSq", type = "l")
which.max(summary(best_subset_fit)$adjr2)
points(10, summary(best_subset_fit)$adjr2[10], col = "red", cex = 2, pch = 20)
```

# Forward stepwise selection

```{r}
forward_step_fit <- regsubsets(output ~ ., data = heart_dat, nvmax = 13, 
                               method = "forward")

summary(forward_step_fit)
```

```{r}
# Finding the number of predictors in the models selected by forward stepwise 
# selection that has the largest R^2

plot(summary(forward_step_fit)$adjr2, xlab = "Number of Variables", 
     ylab = "Adjusted RSq", type = "l")
which.max(summary(forward_step_fit)$adjr2)
points(10, summary(forward_step_fit)$adjr2[10], col = "red", cex = 2, pch = 20)
```

# Backward stepwise selection

```{r}
backward_step_fit <- regsubsets(output ~ ., data = heart_dat, nvmax = 13, 
                               method = "backward")

summary(backward_step_fit)
```

```{r}
# Finding the number of predictors in the models selected by backward stepwise 
# selection that has the largest R^2

plot(summary(backward_step_fit)$adjr2, xlab = "Number of Variables", 
     ylab = "Adjusted RSq", type = "l")
which.max(summary(backward_step_fit)$adjr2)
points(10, summary(backward_step_fit)$adjr2[10], col = "red", cex = 2, pch = 20)
```

The adjusted R^2 value is the largest for the models with 10 predictors 
selected by each best subset selection, forward stepwise selection, and backward
stepwise selection.

# Selecting the Best Model via Cross Validation

```{r}
# 10-fold cross validation - code adapted from Lab 4

predict.regsubsets = function (object ,newdata ,id ,...){ 
  form=as.formula(object$call[[2]]) 
  mat=model.matrix(form,newdata) 
  coefi=coef(object ,id=id) 
  xvars=names(coefi) 
  mat[,xvars]%*%coefi 
}

k = 10
set.seed(1)
folds = sample(1:k, nrow(heart_dat), replace = TRUE)
cv.errors = matrix(NA, k, 13, dimnames = list(NULL, paste(1:13)))

for(j in 1:k){ 
  best.fit=regsubsets(output~.,data=heart_dat[folds!=j,], nvmax =13) 
  
  for(i in 1:13){
    pred=predict(best.fit,heart_dat[folds==j,],id=i)
    cv.errors[j,i]=mean((heart_dat$output[folds==j]-pred)^2)
  } 
}

mean.cv.errors = apply(cv.errors, 2, mean)
which.min(mean.cv.errors)
```

Cross validation selects an 11-variable model.

```{r}
plot(mean.cv.errors, type = "b")
```

```{r}
# Finding the best model with 11 predictors using best subset selection

reg.best=regsubsets(output~., data = heart_dat, nvmax=13)
                    
coef(reg.best,11)
```

```{r}
# Finding the best model with 11 predictors using forward stepwise selection

reg.best_fwd=regsubsets(output~., data = heart_dat, nvmax=13, method = "forward")
                    
coef(reg.best_fwd,11)
```

```{r}
# Finding the best model with 11 predictors using backward stepwise selection

reg.best_backwd=regsubsets(output~., data = heart_dat, nvmax=13, method = "backward")
                    
coef(reg.best_backwd,11)
```

Getting same results from best subset selection, forward stepwise selection, 
and backward stepwise selection --> not really sure why --> don't get same 
results 

# logistic regression

```{r}
# model with all 11 predictors selected by cross validation

heart_logreg <- glm(output~sex+cp+trtbps+chol+restecg+thalachh+exng+oldpeak+slp+caa+thall,
                    family = "binomial", data = heart_dat)
summary(heart_logreg)
```

```{r}
# model with just the statistically significant predictors from above

heart_logreg_red <- glm(output~sex+cp+trtbps+thalachh+exng+oldpeak+caa+thall,
                    family = "binomial", data = heart_dat)
summary(heart_logreg_red)
```

All variables that were statistically significant in the model chosen from CV
are still statistically significant. 

# LDA

```{r}
# LDA on the best model, which has 11 predictors

library(MASS)

lda.fit = lda(output ~ sex+cp+trtbps+chol+restecg+thalachh+exng+oldpeak+slp+caa+thall, 
              data = heart_dat)

lda.fit
```

# QDA

```{r}
# QDA on the best model, which has 11 predictors

library(MASS)

qda.fit = qda(output ~ sex+cp+trtbps+chol+restecg+thalachh+exng+oldpeak+slp+caa+thall, 
              data = heart_dat)

qda.fit
```


